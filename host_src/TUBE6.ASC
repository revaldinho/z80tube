10  'Amstrad CPC-Acorn Tube Host Code
20  '(C) 2018 Hoglet, BigEd, Revaldinho
30 MODE 2
40 INK 0,0 : INK 1,26 : BORDER 0
50 MEMORY HIMEM-128
60 fifo1 = HIMEM+1
70 GOSUB 4000
80 OUT &FC16, 7  :' Select CPU
90 OUT &FC10,&A0 :' Tube RESET
100 OUT &FC10,&20
110 WHILE 1=1
120   GOSUB 190
130   'PRINT HEX$(A,2);" ";
140   ' A=            0 ,   1 ,  2,    3  , 4 , 5 ,  6 , 7 , 8 , 9 , 10
150   ON (A+1) GOSUB 400, 380, 430, 380, 380,380, 380,380,380,380,520
160 WEND
170 END
180 ' Get FIFO R2 data in A without blocking FIFO R1 traffic
190 WHILE (INP(&FC12) AND &80)=0 
200   CALL fifo1
210 WEND
220 A =INP(&FC13)
230 RETURN
240 ' Write parameter T to FIFO R2 without blocking FIFO R1 traffic
250 WHILE (INP(&FC12) AND &40)=0 
260   'CALL fifo1
270 WEND
280 OUT &FC13, T
290 RETURN
300 ' Write string parameter T$ to FIFO R2, terminated with &0D
310 FOR i=1 TO LEN(T$)
320   T= ASC(MID$(T$,i,1))
330   GOSUB 250
340 NEXT
350 T=13 : GOSUB 250
360 RETURN
370 'DUMMY Destination for unhandled calls
380 RETURN
390 'RDCH
400 PRINT "RDCH"
410 RETURN
420 ' Read and report CLI string
430 CLISTR$ = ""
440 WHILE A<> &D
450   GOSUB 190
460   CLISTR$ = CLISTR$+CHR$(A) 
470 WEND
480 PRINT "OSCLI Str ", CLISTR$
490 T=&7F : GOSUB 250
500 RETURN
510 ' Read and handle OSWORD0
520 FOR B=1 TO 5
530   GOSUB 190
540 NEXT
550 T=&7F : GOSUB 250
560 INPUT T$
570 GOSUB 310
580 RETURN
4000 |ASSEMBLE
4010 '.top
4020 'LD B,&FC
4030 'LD C,&10
4040 'IN A,(C)
4050 'RET P
4060 'LD C,&11
4070 'IN A,(C)
4080 'PUSH AF
4090 'CALL &BB5A
4100 'POP AF
4110 'JR NZ, top
4120 'LD B,&FC
4130 'LD C,&13
4140 'LD A,&7F
4150 'OUT (C),A
4160 'JR top
4170 'END
4180 RETURN
